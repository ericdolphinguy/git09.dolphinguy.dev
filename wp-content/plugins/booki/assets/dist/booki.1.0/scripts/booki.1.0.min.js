/*
 Copyright @ 2014 Alessandro Zifiglio. All rights reserved. http://www.booki.io
*/
(function(d){var r={create:function(j,q,e){var m;if(e){m=new Date;m.setTime(m.getTime()+e*24*60*60*1E3);e="; expires="+m.toGMTString()}else e="";document.cookie=j+"="+q+e+"; path=/"},read:function(j){j=j+"=";var q=document.cookie.split(";"),e,m;for(m=0;m<q.length;m++){for(e=q[m];e.charAt(0)==" ";)e=e.substring(1,e.length);if(e.indexOf(j)==0)return e.substring(j.length,e.length)}return null},erase:function(j){r.create(j,"",-1)},destroy:function(){return this.each(function(){})}};d.fn.BookiCookie=function(j){if(r[j])return r[j].apply(this,
Array.prototype.slice.call(arguments,1));else d.error("Method "+j+" does not exist on jQuery.BookiCookie")}})(window.jQuery);
(function(d,r,j){d.fn.Booki=function(q){var e,m,i,l,z,C,w,t,o,g,p,k,u,y,v,B,Q,La,Ma,Y,qa,K,ra,sa,L,Z,aa,S,F,G,H,ta,ba,la,T="",Na,Oa,R,Pa,U,ua=[],ca,Qa,Ra,va,ma,wa,Sa,V,xa,Ta,ya,Ua,za,Va,Wa,da,Xa,N,Aa,Ya,Za,ea,fa,$a,ab,bb,cb,Ba,Ca,db,eb,W,fb,ga,M,gb,hb,ha,ib,X,na,Da,Ea,oa,Fa,E,jb,Ga,Ha,Ia,Ja,O,D,ia,kb,lb,mb,nb,ob,pa,pb,qb,ja,rb,s={init:function(a){e=this;var c=this[0],b,f;d(document).ready(function(){s.bootstrap();d(".booki_parsley_validated").submit(function(){return this.parsley("validate")});b=
d.extend({},a);i=b.calendarPeriod;m=b.dateFormat;Na=b.altFormat;l=b.calendar;z=b.calendarDays;C=b.minDate;w=b.maxDate;H=b.currencySymbol;F=b.decimalPoint;G=b.thousandsSep;T=b.timezone;ta=b.ajaxurl;Qa=e.find(".booki-days-exhausted");Ra=e.find(".booki-time-slots-exhausted");va=e.find(".booki-time-slots-booked");t=e.find(".booki-optional");o=e.find(".booki-single-datepicker");g=e.find(".booki-datepicker-from");p=e.find(".booki-datepicker-to");k=e.find(".booki-booking-limit");e.find(".booki-datepicker-min-date-selection");
u=e.find(".booki-single-datepicker-group .input-group-addon");v=e.find(".booki-selected-date");ra=b.bookingDaysMinimum;L=b.bookingDaysLimit;La=e.find(".booki-totals-label");B=e.find('select[name="time[]"]');Q=e.find('select[name="timezone"]');Ma=e.find('input[name="autodetect"]');Oa=b.bookingMode;R=b.calendarMode;U=b.usedSlots;Pa=b.autoTimezoneDetection;ca=b.timeSelector;ma=b.discount;wa=b.bookingMinimumDiscount;Sa=b.bookedItemsCount;V=b.includeBookingPrice;N=b.calendarCssClasses;Aa=b.calendarFirstDay;
Ya=b.showCalendarButtonPanel;Za=b.displayBookedTimeSlots;xa=e.find(".booki-sub-total");ya=e.find(".booki-deposit");Ua=e.find(".booki-deposit-label");Ta=e.find(".booki-sub-total-label");za=e.find(".booki-discount");Va=e.find(".booki-discount-label");Wa=e.find(".booki_optionals_count");ba=e.find(".progress.booki-time-progress");Ba=b.optionalsBookingMode;eb=b.defaultCascadingListSelectionLabel;Ca=b.highlightSelectedOptionals;db=e.find(".booki-cascading-list");da=e.find(".progress.booki-progress-cascades");
W=b.hideSelectedDays;sa=e.find(".booki-minimum-days-required");Xa=e.find('input[name="deposit_field"]');qa=e.find('button[name="booki_checkout"][value="1"]');Ma.on("click",function(){d(this).is(":checked")&&X(O(v.val()))});y=e.find(".booki-dates");Y=e.find('button[name="booki_add_cart"]');v.val(O(C));L>1&&i===0&&y.addClass("booki-outer-border");o.on("keydown",oa);g.on("keydown",oa);p.on("keydown",oa);Q.change(jb);d(U).each(function(h,n){n.slotsExhausted&&ua.push(n.day)});if(f=ib())t.change(d.proxy(M,
c));else{t.attr("disabled",true);Y.attr("disabled",true)}ca===1&&B.change(d.proxy(qb,c));db.on("change",kb);M()});d(document).ajaxStop(function(){ba&&ba.hide()});d(document).ajaxStop(function(){da&&da.hide()})},timeSlotsChanged:function(){var a=ja(),c=B.find("option:selected");if(!a)for(a=0;a<c.length;a++)a>=L&&d(c[a]).removeAttr("selected");M()},bookingDaysLimitCheck:function(a){var c=E(),b=true;c=i===0?c.length:B.find("option:selected").length;if(typeof a!=="undefined")c=a;if(L>1&&c>L){k.removeClass("hide");
b=false}else k.addClass("hide");return b},minimumDaysCheck:function(){var a=E(),c=true;a=i===0?a.length:B.find("option:selected").length;if(ra&&a<ra){c=false;sa.removeClass("hide");Y.attr("disabled",true)}else{sa.addClass("hide");Y.removeAttr("disabled")}c&&Fa();return c},getSelectedDates:function(){var a=v.val();return a?a.split(","):[]},addSelectedDates:function(a){var c=j.formatMoney(ga(a),H,2,G,F),b=y.find("li"),f='<i class="glyphicon glyphicon-trash"></i>';c='<span class="booki-remove-button-container">'+
(V?'<span class="badge">'+c+"</span>":"");var h=E(),n=false,x;b.each(function(A,I){if(d(I).data("value")===a){n=true;return false}});if(!n){if(h.length===1)f="";if(L===1||i===1)y.empty();y.append('<li data-value="'+a+'"><span class="pull-left">'+a+"</span>"+c+f+"</span></li>");x=y.find('[data-value="'+a+'"]');if(h.length>1){x.find("i").on("click",Ea);b=y.find('[data-value="'+h[0]+'"] span.booki-remove-button-container');c=b.find("i");if(c.length===0){b.append(f);b.find("i").on("click",Ea)}}window.setTimeout(function(){x.addClass("booki-slide-in")},
50)}},onSelectedDateRemoveClick:function(){var a=d(this).parent().parent().data("value");Da(a);ja();M()},selectedDateRemove:function(a){var c=E(),b,f,h;if(c.length>1){for(b in c)if(c[b]===a){c.splice(b,1);break}if(!W){a=e.find('[data-value="'+a+'"]');a.removeClass("booki-slide-in");(function(n){window.setTimeout(function(){n.remove()},1E3)})(a)}}v.val(c.join());c.length===1&&!W&&e.find('[data-value="'+c[0]+'"]').find("i").remove();if(c.length>0){f=D(c[0]);h=D(c[c.length-1]);for(b in c){a=D(c[b]);
if(a.isAfter(h))h=a;if(a.isBefore(f))f=a}(function(n,x){window.setTimeout(function(){if(o.length>0)o.datepicker("setDate",O(x));else{g.datepicker("setDate",O(n));p.datepicker("setDate",O(x))}},50)})(f,h)}},testAddToCartButton:function(){var a=!v.val();Y.prop("disabled",a);return!a},formatDate:function(a){return r(a).format(m)},formatMoment:function(a){return r(a,m)},calculateSelectedDaysCost:function(){var a=E(),c=a.length,b,f,h=0;for(f=0;f<c;f++){b=a[f];h+=ga(b)}return h},getCost:function(a){var c,
b=z.length,f;for(c=0;c<b;c++){f=z[c];if(a===f.day)return ia(f.cost)}return ia(l.cost)},updateTotal:function(){Fa();if(V){var a=0,c=B.find("option:selected").length,b=E(),f=fb(),h=ma>0&&(Sa>=wa||wa===0),n=ca===1&&c>1?c:b.length,x;b=ob();n||(n=1);d(".booki-cascading-list option").each(function(A,I){var J=d(I),P=ia(J.data("bookiCost")),ka=parseInt(J.data("bookiParent"),10),Ka=J.data("bookiOriginalValue");if(P!==0&&!isNaN(P)&&ka===-1){if(Ba===1){P*=n;J.html(Ka+"&nbsp;&nbsp;x "+n+" = "+j.formatMoney(P,
H,2,G,F))}if(J.is(":selected"))a+=P}});t.each(function(A,I){var J=d(I),P=ia(J.data("cost")),ka=d(J.parent()),Ka=ka.find(".booki_optionals_cost");if(Ba===1){P*=n;Wa.html(" x "+n)}if(J.is(":checked")){a+=P;Ca&&ka.addClass("active")}else Ca&&ka.removeClass("active");x=j.formatMoney(P,H,2,G,F);Ka.html(x)});if(ca===1&&c>1)f*=c;Ja();a+=f;if(h||b>0){xa.removeClass("hide");Ta.html(j.formatMoney(a,H,2,G,F))}else xa.addClass("hide");if(h){za.removeClass("hide");Va.html(-ma+"%");a-=ma/100*a}else za.addClass("hide");
if(b>0){c=a/100*b;a-=c;ya.removeClass("hide");Ua.html(j.formatMoney(c,H,2,G,F))}else ya.addClass("hide");c=j.formatMoney(a,H,2,G,F);La.html(c);a>0?qa.removeClass("hide"):qa.addClass("hide");pb()}},allowAdvanceBooking:function(a,c){var b=D(a),f=r();c&&f.startOf("day");b=b.diff(f,"days");if(l.bookingStartLapse!==0&&b<l.bookingStartLapse)return false;return true},beforeShowDay:function(a){var c=a.getDay(),b=true,f=E(),h=false,n=O(a);if(!pa(n,true))return[false];d(l.daysExcluded).each(function(x,A){if(A===
n)return b=false});Oa===1&&d(U).each(function(x,A){if(A.day===n&&A.slotsExhausted)return b=false});if(!b)return[b];d(l.weekDaysExcluded).each(function(x,A){if(c===A)return b=false});if(!b)return[b];d(f).each(function(x,A){if(n===A){h=true;return false}});if(h){if(R===0||R===1){W||na(n);i===1&&B.find("options").length>0&&X(n)}return[b," highlighted-day",".."]}return[true,n,""]},dateSelected:function(a){d(this);var c=E(),b=c.length;i&&X(a);la=a;if(d.inArray(a,c)!==-1){Da(a);ja()}else if(L<=1||i===1){v.val(a);
if(V){a=j.formatMoney(ga(a),H,2,G,F);u.html(a)}}else if(b<L){c.push(a);v.val(c.join());W||na(a)}else if(b>0){(function(f,h){window.setTimeout(function(){o.datepicker("setDate",f[h-1])},50)})(c,b);b===L&&k.removeClass("hide")}M()},disableBackspace:function(a){a.keyCode===8&&a.preventDefault()},adjustByAvailability:function(a){var c,b,f,h;U.sort(function(n,x){return D(n.day)-D(x.day)});for(h in U){c=U[h];b=D(c.day);f=a.diff(b,"days");if(a.isBefore(b)&&f===1||a.isSame(b))if(c.slotsExhausted)a=a.add("days",
1)}return a},applyDeposit:function(){var a=E(),c,b,f,h,n,x=r(),A;a.sort(function(I,J){return D(I)-D(J)});for(b=0;b<a.length;b++){c=a[b];for(f=0;f<z.length;f++){h=z[f];if(c===h.day){n=D(h.day);n=n.diff(x,"days");if(n>h.minNumDaysDeposit){A=h.deposit;break}}}if(A>0)break}if(!A){n=D(a[0]);n=n.diff(x,"days");if(l.minNumDaysDeposit===0||n>l.minNumDaysDeposit)A=l.deposit}Xa.val(A);return A},datePicker:function(){var a=D(C),c=D(w);for(ha(a);(a.isBefore(c)||a.isSame(c))&&l.weekDaysExcluded.indexOf(a.weekday())>
-1;){a.add("days",1);ha(a)}for(l.daysExcluded.sort(function(b,f){return D(b)-D(f)});(a.isBefore(c)||a.isSame(c))&&l.daysExcluded.indexOf(O(a))>-1;){a.add("days",1);ha(a)}for(;!pa(a,true)&&a.isBefore(c);){a.add("days",1);ha(a)}if(a.isAfter(c)){v.val("");Qa.removeClass("hide");Ra.removeClass("hide");o.addClass("booki-readonly-field");g.addClass("booki-readonly-field");p.addClass("booki-readonly-field");B.attr("disabled",true);if(V){a=j.formatMoney(0,H,2,G,F);u.html(a)}return false}K=O(a);v.val(K);c=
{dateFormat:Na,defaultDate:a._d,minDate:a._d,maxDate:c._d,beforeShowDay:gb,hideIfNoPrevNext:true,showButtonPanel:Ya};if(Aa<7)c.firstDay=Aa;if(o.length>0){c.onSelect=hb;o.datepicker(c);if(V){a=j.formatMoney(ga(K),H,2,G,F);u.html(a)}o.datepicker("setDate",K);v.val(K);i===1&&X(K);N&&o.addClass(N)}if(g.length>0){c.onClose=function(b){var f=E();p.length>0&&p.datepicker("option","minDate",b);f.length>0&&Ia()};g.datepicker(c);g.datepicker("setDate",K);N&&g.addClass(N)}if(p.length>0){c.onClose=function(b){g.length>
0&&g.datepicker("option","maxDate",b);Ia()};p.datepicker(c);p.datepicker("setDate",K);N&&p.addClass(N)}Ha();N&&d("#ui-datepicker-div").addClass(N);return true},onRangeClose:function(){Ha()},timezoneChanged:function(){d(this);var a=d(this).find(":selected").val();X(la,a);T=a},getTimeSlots:function(a,c){var b,f=z.length,h,n;la=a;va.addClass("hide");if(typeof c==="undefined"){b=d().BookiTimezoneControlState("readState");c=b.selectedZone;Pa||(c=T)}Z=l.hours;aa=l.minutes;ea=l.hourStartInterval;fa=l.minuteStartInterval;
n=l.timeExcluded;for(b=0;b<f;b++){h=z[b];if(h.day==a){Z=h.hours;aa=h.minutes;ea=h.hourStartInterval;fa=h.minuteStartInterval;n=h.timeExcluded;break}}if(Z===$a&&aa===ab&&ea===bb&&fa===cb&&T===c)Ga(n);else{$a=Z;ab=aa;bb=ea;cb=fa;T=c;ba.removeClass("hide");ba.show();(function(x){d.post(ta,{model:{hours:Z,minutes:aa,hourStartInterval:ea,minuteStartInterval:fa,enableSingleHourMinuteFormat:l.enableSingleHourMinuteFormat,timezone:T},action:"booki_getTimeSlots"},function(A){(S=(A=d.parseJSON(A).result)?A.timeslots:
null)&&Ga(x)})})(n)}},renderTimeslots:function(a){var c,b,f,h,n=S.length,x=r(),A=[];B.empty();B.prop("disabled",false);for(c=0;c<n;c++){b=S[c].value.split(",");f="";if(a.indexOf(b[0])!==-1){if(!Za)continue;f=' disabled class="booki-option-disabled"'}A.push(S[c]);h=S[c].rawFrom.split(":");h=D(la).hour(h[0]).minute(h[1]);if(!(h<x))if(pa(h,false)){b='<option value="'+b+'"'+f+">"+S[c].text+"</option>";B.append(b)}}if(B.find("option").length===0||B.find("option:not(:disabled)").length===0){B.prop("disabled",
true);va.removeClass("hide")}Ja()},ensureTimeSlotSelection:function(){var a;if(ca===1){a=B.find("option:selected");if(!(a.length>0)){a=B.find("option").not("[disabled]");a.length>0&&d(a[0]).attr("selected",true)}}},addDatesFromRange:function(){var a=[],c,b=D(K),f=D(K),h;if(R===2||R===3){if(g.length>0)b=r(g.datepicker("getDate"));if(p.length>0)f=r(p.datepicker("getDate"))}else if(L>1&&i===0){if(p.length>0)f=r(p.datepicker("getDate"))}else return;f=R===3?f.diff(b,"days"):f.diff(b,"days")+1;f=rb(b,f);
if(ja(f)){y.empty();if(f===0&&R===3)a.push(b.format(m));else{b=b.subtract("days",1);for(h=0;h<f;h++){b=b.add("days",1);c=b.format(m);l.weekDaysExcluded.indexOf(b.weekday())>-1||l.daysExcluded.indexOf(c)>-1||ua.indexOf(c)>-1||a.push(c)}}v.val(a.join());if(!W)for(c in a)na(a[c]);M()}else{a=E();c=a[a.length-1];p.datepicker("setDate",c);p.datepicker("option","minDate",c)}},validateRangeDiff:function(a,c){var b,f,h=0;a=a.clone().subtract("days",1);for(b=0;b<c;b++){a=a.add("days",1);f=a.format(m);l.weekDaysExcluded.indexOf(a.weekday())>
-1||l.daysExcluded.indexOf(f)>-1||ua.indexOf(f)>-1||++h}return h},cascadingListItemSelected:function(a){a=a.srcElement||a.target;var c=d("option:selected",a);parseInt(c.val(),10);c=c.data("bookiParent");a=d(a).data("bookiPlaceholder");M();if(!(typeof c==="undefined"||c==="")){c=parseInt(c,10);if(c!==-1){da.removeClass("hide");da.show();(function(b,f){d.post(ta,{model:{id:b},action:"booki_readCascadingItemsByListId"},function(h){h=d.parseJSON(h);mb(h,f)})})(c,a)}}},createCascadingList:function(a,c){var b,
f,h=a.cascadingItems,n="booki_cascadingdropdown_"+a.id,x=d("<select></select>").attr("id",n).attr("name",n).addClass("form-control booki-cascading-list booki_parsley_validated"),A=lb(n,a.label);n="#"+n+"_container";var I;if(a.isRequired){x.attr("data-parsley-trigger","change");x.attr("data-parsley-required",true)}f=d("<option></option>").attr("value","").html(eb);x.append(f);for(b in h){f=h[b];I=f.value;if(f.cost>0&&f.parentId===-1)I+="&nbsp;&nbsp;"+j.formatMoney(f.cost,H,2,G,F);f=d("<option></option>").attr("value",
f.id).attr("data-booki-parent",f.parentId).attr("data-booki-cost",f.cost).attr("data-booki-original-value",f.value).html(I);x.append(f)}d(c).empty().html(A);d(n).append(x);x.on("change",nb);M()},getFormGroup:function(a,c){var b='<div class="form-group">';b+='<label class="col-lg-4 control-label" for="'+a+'">';b+=c;b+="</label>";b+='<div class="col-lg-8">';b+='<div id="'+a+'_container"></div>';b+="</div>";b+="</div>";return b},cascadingItemSelected:function(){M()},parseDouble:function(a){return parseFloat((""+
a).replace(/,/g,""))},bootstrap:function(){O=s.formatDate;D=s.formatMoment;fb=s.calculateSelectedDaysCost;ga=s.getCost;M=s.updateTotal;gb=s.beforeShowDay;hb=s.dateSelected;ib=s.datePicker;ha=s.adjustByAvailability;X=s.getTimeSlots;na=s.addSelectedDates;Da=s.selectedDateRemove;Ea=s.onSelectedDateRemoveClick;Fa=s.testAddToCartButton;E=s.getSelectedDates;jb=s.timezoneChanged;Ga=s.renderTimeslots;Ha=s.addDatesFromRange;Ia=s.onRangeClose;oa=s.disableBackspace;Ja=s.ensureTimeSlotSelection;ia=s.parseDouble;
kb=s.cascadingListItemSelected;lb=s.getFormGroup;mb=s.createCascadingList;nb=s.cascadingItemSelected;ob=s.applyDeposit;pa=s.allowAdvanceBooking;pb=s.minimumDaysCheck;qb=s.timeSlotsChanged;ja=s.bookingDaysLimitCheck;rb=s.validateRangeDiff},destroy:function(){return this.each(function(){})}};if(s[q])return s[q].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof q==="object"||!q)return s.init.apply(this,arguments);else d.error("Method "+q+" does not exist on jQuery.Booki")}})(window.jQuery,
window.moment,window.accounting);
(function(d){d.fn.BookiBookingWizard=function(r){var j,q,e,m,i,l,z,C,w={init:function(t){var o=this,g;d(document).ready(function(){z=o;g=d.extend({},t);if(g.projectId!==undefined)j=g.projectId;if(g.bookingButton)q=typeof g.bookingButton==="string"?o.find(g.bookingButton):g.bookingButton;if(g.nextButton)e=typeof g.nextButton==="string"?o.find(g.nextButton):g.nextButton;if(g.backButton)m=typeof g.backButton==="string"?o.find(g.backButton):g.backButton;if(g.step1)i=typeof g.step1==="string"?o.find(g.step1):
g.step1;if(g.tabs)l=typeof g.tabs==="string"?o.find(g.tabs):g.tabs;C=d(g.errorContainer);if(l.length<2){i&&i.tab("show");e.addClass("hide");m.addClass("hide")}else{e.on("click",w.wizardButtonClick);m.on("click",w.wizardButtonClick);w.toggleButtons(0);l.on("click",w.tabsClick);d("[data-toggle=tooltip]").tooltip()}})},validate:function(){w.isValid()?C.addClass("hide"):C.removeClass("hide")},tabsClick:function(t){var o=d(this);t.preventDefault();w.validate();w.toggleButtons(o.data("step"))},toggleButtons:function(t){if(parseInt(t,
10)===0){q.addClass("hide");e.removeClass("hide");m.addClass("hide")}else{q.removeClass("hide");e.addClass("hide");m.removeClass("hide")}d(".booki"+j+'.nav.nav-tabs a[data-step="'+t+'"]').tab("show")},wizardButtonClick:function(t){t=d(t.currentTarget);w.validate();w.toggleButtons(t.data("step"))},isValid:function(){var t=true;z.find(".booki_parsley_validated").each(function(){var o=d(this);if(!o.is(":visible")||o.is(":disabled"))return true;o=o.parsley().validate(true);if(o!==null&&typeof o==="object"&&
o.length>0)t=false});return t},destroy:function(){return this.each(function(){})}};if(w[r])return w[r].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof r==="object"||!r)return w.init.apply(this,arguments);else d.error("Method "+r+" does not exist on jQuery.BookiBookingWizard")}})(window.jQuery,window.moment);(function(d){d(document).ready(function(){d("[data-toggle=tooltip]").tooltip();d("[data-toggle=popover]").popover({container:"body"})})})(window.jQuery);
(function(d){d.fn.BookiModalPopup=function(r){var j,q={init:function(e){var m;j=this;d(document).ready(function(){d.extend({},e);m=j.find(".booki-confirm");j.on("show.bs.modal",function(i){i=d(i.relatedTarget).data("bookiId");m.attr("value",i)})})},destroy:function(){j.off()}};if(q[r])return q[r].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof r==="object"||!r)return q.init.apply(this,arguments);else d.error("Method "+r+" does not exist on jQuery.BookiModalPopup")}})(window.jQuery);
(function(d,r){d.fn.BookiSearchFilter=function(j){var q={init:function(e){var m=this,i,l,z,C=null,w=null,t,o,g,p,k,u;d(document).ready(function(){i=d.extend({},e);if(i.fromDefaultDate)C=r(i.fromDefaultDate);if(i.toDefaultDate)w=r(i.toDefaultDate);l=m.find(i.fromDateElem);z=m.find(i.toDateElem);p=i.calendarFirstDay;k=i.showCalendarButtonPanel;u=i.calendarCssClasses;t=i.altFormat;o={dateFormat:t,changeMonth:true,changeYear:true,showButtonPanel:k};if(C)o.defaultDate=C._d;g={dateFormat:t,changeMonth:true,
changeYear:true,showButtonPanel:k};if(w)g.defaultDate=w._d;if(p<7){g.firstDay=p;o.firstDay=p}if(l.length>0){l.datepicker(o);u&&l.addClass(u)}if(z.length>0){z.datepicker(g);u&&z.addClass(u)}u&&d("#ui-datepicker-div").addClass(u)})},destroy:function(){return this.each(function(){})}};if(q[j])return q[j].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof j==="object"||!j)return q.init.apply(this,arguments);else d.error("Method "+j+" does not exist on jQuery.BookiSearchFilter")}})(window.jQuery,
window.moment);
(function(d,r){d.fn.BookiTimezoneControl=function(j){var q,e,m,i,l,z,C,w,t,o,g,p={init:function(k){var u=this,y,v;d(document).ready(function(){y=d.extend({},k);e=u.find(y.region);m=u.find(y.timezone);i=m.find('select[name="timezone"]');l=u.find('input[name="autodetect"]');q=u.find(y.headerCaption);C=d(y.loadOnStart);t=d(y.timezoneManualSelection);w=u.find(".collapseTimezone");z=u.find(".progress");o=y.ajaxurl;i.on("change",function(){if(g)g=false;else{var B=d(this).find(":selected");q.html(B.text());
l.prop("checked",false);p.saveState(false,B.val());w.collapse("hide")}});e.on("change",function(){var B=d(this).val();p.timezoneChoice(B,null)});l.length>0&&l.on("click",function(){var B=d(this).is(":checked"),Q;if(B)Q=p.guessTimezone(null,true);else{Q=p.readState();Q=Q.selectedZone}p.saveState(B,Q)});v=p.getDefaultTimezone();l.prop("checked",v.autoRun);if(t.length>0){v.selectedZone=t.val();u.find(".autodetect").addClass("hide")}p.saveState(v.autoRun,v.selectedZone);if(q.length>0){q[0].title="";q.html(v.selectedZone)}});
d(document).ajaxStop(function(){z&&z.addClass("hide")})},getDefaultTimezone:function(){var k=d().BookiCookie("read","BOOKITIMEZONE");if(!k){k=r.determine();return{autoRun:true,selectedZone:k.name()}}k=k.split(":");return{autoRun:k[0]==="true",selectedZone:k[1]==="null"?null:k[1]}},parseSavedState:function(k){if(!k)return{autoRun:true,selectedZone:null};k=k.split(":");return{autoRun:k[0]==="true",selectedZone:k[1]==="null"?null:k[1]}},readState:function(k){if(t.length>0)return p.parseSavedState();
k=typeof k==="undefined"?true:k;var u=d().BookiCookie("read","BOOKITIMEZONE"),y=l.is(":checked");if(!u&&k){k=p.guessTimezone();u=p.saveState(y,k)}return p.parseSavedState(u)},saveState:function(k,u){if(t.length>0)return p.parseSavedState();var y=d().BookiCookie("read","BOOKITIMEZONE"),v=k+":"+u;if(v!==y){d().BookiCookie("erase","BOOKITIMEZONE");d().BookiCookie("create","BOOKITIMEZONE",v,30);return v}return y},guessTimezone:function(k,u){var y=r.determine();if(k=typeof k==="undefined"||k===null?y.name():
k){(y=k.substr(0,k.indexOf("/")))||(y=k);p.timezoneChoice(y,k,u);return k}},timezoneChoice:function(k,u,y){if(k==="-1"){m.addClass("hide");i.empty()}else{z.removeClass("hide");d.post(o,{model:{region:k,selectedZone:u},action:"booki_timezoneChoice"},function(v){if(v=(v=d.parseJSON(v).result)?v.options:null){e.length>0&&e.val(k);if(m.length>0){i.html(v);m.removeClass("hide");if(u){v=i.find(":selected");if(q.length>0){q[0].title=v.text();q.html(v.val())}}if(C.length>0&&y)window.setTimeout(function(){g=
true;i.change()},500);else u&&w.collapse("hide")}}})}},destroy:function(){return this.each(function(){})}};if(p[j])return p[j].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof j==="object"||!j)return p.init.apply(this,arguments);else d.error("Method "+j+" does not exist on jQuery.BookiTimezoneControl")}})(window.jQuery,window.jstz);
(function(d,r){d.fn.BookiTimezoneControlState=function(j){var q={init:function(e){var m,i;d.extend({},e);m=q.readState();this.each(function(){var l=d(this);i=l.prop("href");i=q.updateQueryString(i,"timezone",m.selectedZone);l.prop("href",i)})},parseSavedState:function(e){if(!e)return{autoRun:true,selectedZone:null};e=e.split(":");return{autoRun:e[0]==="true",selectedZone:e[1]==="null"?null:e[1]}},readState:function(){var e=d().BookiCookie("read","BOOKITIMEZONE");if(!e){e=q.guessTimezone();e=q.saveState(true,
e)}return q.parseSavedState(e)},saveState:function(e,m){var i=d().BookiCookie("read","BOOKITIMEZONE"),l=e+":"+m;if(l!==i){d().BookiCookie("erase","BOOKITIMEZONE");d().BookiCookie("create","BOOKITIMEZONE",l,30);return l}return i},guessTimezone:function(){return r.determine().name()},updateQueryString:function(e,m,i){var l=RegExp("(\\?|\\&)"+m+"=.*?(?=(&|$))");e=e.toString().split("#");var z=e[1],C=/\?.+$/;e=e[0];m=l.test(e)?e.replace(l,"$1"+m+"="+i):C.test(e)?e+"&"+m+"="+i:e+"?"+m+"="+i;if(z)m+="#"+
z;return m},destroy:function(){return this.each(function(){})}};if(q[j])return q[j].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof j==="object"||!j)return q.init.apply(this,arguments);else d.error("Method "+j+" does not exist on jQuery.BookiTimezoneControlState")}})(window.jQuery,window.jstz);
(function(d){d.fn.BookiUserInfo=function(r){var j,q,e,m,i,l,z,C,w={init:function(t){var o=this,g,p=d("#useremail");d(document).ready(function(){g=d.extend({},t);if(g.triggerButton)i=typeof g.triggerButton==="string"?o.find(g.triggerButton):g.triggerButton;if(g.userIdField)e=typeof g.userIdField==="string"?o.find(g.userIdField):g.userIdField;if(g.userFoundMessage)z=g.userFoundMessage;if(g.userNotFoundMessage)C=g.userNotFoundMessage;l=g.success;m=g.ajaxUrl;j=d(".useremail-info");q=d(".progress.booki-useremail");
i?i.click(function(){w.getUserInfo(p.val());return false}):p.change(function(){w.getUserInfo(d(this).val())})});d(document).ajaxStop(function(){q.addClass("hide")})},getUserInfo:function(t){if(d("#useremail").parsley().validate(true)===true){q.removeClass("hide");d.post(m,{model:{email:t},action:"booki_getUserByEmail"},function(o){o=d.parseJSON(o).result;var g,p,k;if(o){g=o.userName;p=o.firstName;k=o.lastName;e&&e.val(o.id);if(p){g=p;if(k)g+=" "+k}j.removeClass("hide");if(g){j.html(z+": "+g);if(l)l();
else if(i){i.off();i.click()}}else j.html(C)}})}},destroy:function(){return this.each(function(){})}};if(w[r])return w[r].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof r==="object"||!r)return w.init.apply(this,arguments);else d.error("Method "+r+" does not exist on jQuery.BookiUserInfo")}})(window.jQuery);
